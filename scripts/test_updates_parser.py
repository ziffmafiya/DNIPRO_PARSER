#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≥—Ä–∞—Ñ–∏–∫–æ–≤
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from src.schedule_updates_parser import test_parser, process_update_message, update_schedule_from_message
from src.logger import log

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    log("üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π")
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    test_messages = [
        "üì¢ –®–∞–Ω–æ–≤–Ω—ñ —Å–ø–æ–∂–∏–≤–∞—á—ñ! –ü–æ–ø–µ—Ä–µ–¥–∂–∞—î–º–æ, —â–æ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å—å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É –ù–ï–ö \"–£–∫—Ä–µ–Ω–µ—Ä–≥–æ\", –∑ 01:00 –¥–æ 05:00 –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏–º–µ—Ç—å—Å—è –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—ñ–¥—á–µ—Ä–≥–∏ 4.2‚ÄºÔ∏è",
        "üì¢ –®–∞–Ω–æ–≤–Ω—ñ —Å–ø–æ–∂–∏–≤–∞—á—ñ! –ü–æ–ø–µ—Ä–µ–¥–∂–∞—î–º–æ, —â–æ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å—å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É –ù–ï–ö \"–£–∫—Ä–µ–Ω–µ—Ä–≥–æ\", –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—ñ–¥—á–µ—Ä–≥–∏ 5.2 –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è –¥–æ 11:30!!",
        "–î–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏–º–µ—Ç—å—Å—è –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–≥–∏ 3.1 –∑ 14:00 –¥–æ 18:00",
        "–ó–∞ –∫–æ–º–∞–Ω–¥–æ—é –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å—å–∫–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É –ù–ï–ö \"–£–∫—Ä–µ–Ω–µ—Ä–≥–æ\" –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—ñ–¥—á–µ—Ä–≥–∏ 2.1 —Ç–∞ 2.2 –∑ 22:00 –¥–æ 06:00",
    ]
    
    log("\n" + "="*60)
    log("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–ê–†–°–ï–†–ê")
    log("="*60)
    
    for i, message in enumerate(test_messages, 1):
        log(f"\n--- –¢–µ—Å—Ç {i} ---")
        log(f"–°–æ–æ–±—â–µ–Ω–∏–µ: {message}")
        
        result = process_update_message(message)
        if result:
            log(f"‚úÖ –ì—Ä—É–ø–ø—ã: {result['groups']}")
            log(f"‚úÖ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: {result['intervals']}")
            
            # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
            log("üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...")
            try:
                # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ —Ç–µ—Å—Ç–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º
                log("‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ")
            except Exception as e:
                log(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: {e}")
        else:
            log("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å")
    
    log("\n" + "="*60)
    log("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û")
    log("="*60)

if __name__ == "__main__":
    main()