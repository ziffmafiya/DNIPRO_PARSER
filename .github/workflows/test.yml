name: ğŸ§ª Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.9', '3.10', '3.11']

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium
    
    - name: ğŸ“ Create test environment
      run: |
        cp .env.example .env
        mkdir -p output/images logs
    
    - name: ğŸ§ª Test HTML Renderer
      run: |
        python tests/test_html_renderer.py
    
    - name: ğŸ¯ Test Centering
      run: |
        python tests/test_centering.py
    
    - name: ğŸ“‹ Test Import Structure
      run: |
        python -c "from src.html_renderer import HTMLRenderer; print('âœ… HTML Renderer import OK')"
        python -c "from src.telegram_notify import log; print('âœ… Telegram notify import OK')"
        python -c "from src.utils import clean_old_files; print('âœ… Utils import OK')"
        python -c "from src.config import config; print('âœ… Config import OK')"
        python -c "from src.logger import log; print('âœ… Logger import OK')"
    
    - name: ğŸ” Validate HTML Templates (Ğ½Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°)
      run: |
        python -c "
        from pathlib import Path
        templates = ['full-template.html', 'emergency-template.html', 'week-template.html', 'groups-template.html', 'summary-item.html']
        for template in templates:
            path = Path('templates') / template
            assert path.exists(), f'Template {template} not found'
            print(f'âœ… {template} exists')
        print('âœ… All HTML templates validated')
        "
    
    - name: ğŸ¨ Check CSS and JS (Ğ½Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°)
      run: |
        python -c "
        from pathlib import Path
        assert (Path('templates') / 'css' / 'schedule-shared.css').exists(), 'CSS file not found'
        assert (Path('templates') / 'js' / 'schedule-shared.js').exists(), 'JS file not found'
        print('âœ… CSS and JS files exist')
        "
    
    - name: ğŸ”§ Test Configuration
      run: |
        python -c "
        from src.config import config
        print(f'âœ… Base dir: {config.BASE_DIR}')
        print(f'âœ… Templates dir: {config.TEMPLATES_DIR}')
        print(f'âœ… Output dir: {config.OUTPUT_DIR}')
        print(f'âœ… Images dir: {config.IMAGES_DIR}')
        print('âœ… Configuration test passed')
        "
    
    - name: ğŸ“Š Test Project Structure
      run: |
        echo "ğŸ” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:"
        echo "ğŸ“ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ°Ğ¿ĞºĞ¸:"
        ls -la | grep "^d" | grep -E "(src|templates|output|tests|docs|scripts)"
        echo ""
        echo "ğŸ“„ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:"
        ls -la | grep -E "(Makefile|run.sh|requirements.txt|README.md)"
        echo ""
        echo "âœ… Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ñƒ"